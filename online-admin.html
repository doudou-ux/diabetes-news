<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿ç®¡ç†åå° - æ–‡ç« æ”¶å½•</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸŒ åœ¨çº¿ç®¡ç†åå°</h1>
            <p>ç›´æ¥åœ¨çº¿æ·»åŠ å’Œç®¡ç†æ–‡ç« </p>
            <a href="index.html" class="back-link">â† è¿”å›ä¸»é¡µ</a>
        </div>
    </header>

    <main class="container">
        <div class="admin-panel">
            <div class="admin-tips">
                <h3>ğŸ’¡ åœ¨çº¿ç®¡ç†è¯´æ˜</h3>
                <ul>
                    <li>æ–‡ç« æ•°æ®ç›´æ¥ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­</li>
                    <li>æ·»åŠ æ–‡ç« åç«‹å³åœ¨ä¸»é¡µé¢ç”Ÿæ•ˆ</li>
                    <li>æ— éœ€ä¸‹è½½å’Œä¸Šä¼ æ–‡ä»¶</li>
                    <li>å»ºè®®å®šæœŸå¯¼å‡ºæ•°æ®ä½œä¸ºå¤‡ä»½</li>
                </ul>
            </div>
            
            <form id="onlineArticleForm" class="article-form">
                <div class="form-group">
                    <label for="onlineTitle">æ–‡ç« æ ‡é¢˜ *</label>
                    <input type="text" id="onlineTitle" required>
                </div>

                <div class="form-group">
                    <label for="onlineUrl">åŸæ–‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="url" id="onlineUrl" placeholder="å¦‚æœæœ‰åŸæ–‡é“¾æ¥å¯ä»¥å¡«å†™">
                </div>

                <div class="form-group">
                    <label for="onlineDescription">æ–‡ç« æ‘˜è¦</label>
                    <textarea id="onlineDescription" rows="3" placeholder="ç®€å•æè¿°è¿™ç¯‡æ–‡ç« çš„å†…å®¹..."></textarea>
                </div>

                <div class="form-group">
                    <label for="onlineContent">æ–‡ç« å†…å®¹ (Markdownæ ¼å¼) *</label>
                    <textarea id="onlineContent" rows="15" required placeholder="åœ¨è¿™é‡Œç²˜è´´ä½ çš„markdownæ ¼å¼æ–‡ç« å†…å®¹..."></textarea>
                    <div class="content-tools">
                        <button type="button" id="onlineCleanup" class="tool-btn">ğŸ§¹ æ¸…ç†å†…å®¹</button>
                        <button type="button" id="onlineFixImages" class="tool-btn">ğŸ”§ ä¿®å¤å›¾ç‰‡</button>
                        <button type="button" id="onlineConvert" class="tool-btn">ğŸ–¼ï¸ è½¬æ¢ä¸ºå ä½ç¬¦</button>
                    </div>
                    <small style="color: #666;">
                        <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong><br>
                        â€¢ ç›´æ¥ç²˜è´´å›¾æ–‡æ··åˆå†…å®¹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¿æŒæ ¼å¼<br>
                        â€¢ <strong>ğŸ”§ ä¿®å¤å›¾ç‰‡</strong>ï¼šå°† [å›¾ç‰‡](é“¾æ¥) æ ¼å¼è½¬æ¢ä¸ºæ­£ç¡®çš„ ![å›¾ç‰‡](é“¾æ¥) æ ¼å¼<br>
                        â€¢ <strong>ğŸ§¹ æ¸…ç†å†…å®¹</strong>ï¼šä¼˜åŒ–æ–‡æœ¬æ ¼å¼ï¼Œç§»é™¤å¤šä½™ç©ºæ ¼å’Œæ¢è¡Œ<br>
                        â€¢ <strong>ğŸ–¼ï¸ è½¬æ¢ä¸ºå ä½ç¬¦</strong>ï¼šå°†é•¿base64å›¾ç‰‡è½¬ä¸ºç®€æ´å ä½ç¬¦<br>
                        â€¢ å›¾ç‰‡ä¼šä¿æŒåŸå§‹æ ¼å¼ï¼Œå¯ä»¥æ­£å¸¸æ˜¾ç¤º
                    </small>
                </div>

                <div class="form-group">
                    <label for="onlineTags">æ ‡ç­¾</label>
                    <input type="text" id="onlineTags" placeholder="ç”¨é€—å·åˆ†éš”ï¼Œå¦‚ï¼šæŠ€æœ¯,å‰ç«¯,JavaScript">
                </div>

                <div class="form-group">
                    <label for="onlineRating">æ¨èæŒ‡æ•°</label>
                    <select id="onlineRating">
                        <option value="5">â­â­â­â­â­ å¼ºçƒˆæ¨è</option>
                        <option value="4">â­â­â­â­ å€¼å¾—ä¸€è¯»</option>
                        <option value="3">â­â­â­ è¿˜ä¸é”™</option>
                        <option value="2">â­â­ ä¸€èˆ¬</option>
                        <option value="1">â­ ä¸æ¨è</option>
                    </select>
                </div>

                <button type="submit" class="submit-btn">ç«‹å³å‘å¸ƒæ–‡ç« </button>
            </form>
        </div>

        <div class="articles-management">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                <h2>å·²å‘å¸ƒæ–‡ç« </h2>
                <div>
                    <button id="exportData" class="view-site-btn">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
                    <button id="importData" class="view-site-btn" style="background: #ffc107;">ğŸ“¤ å¯¼å…¥æ•°æ®</button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                </div>
            </div>
            <div id="onlineArticlesList" class="admin-articles-list">
                <!-- æ–‡ç« åˆ—è¡¨å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
            </div>
        </div>
    </main>

    <script>
        class OnlineAdminManager {
            constructor() {
                this.articles = [];
                this.init();
            }

            init() {
                this.loadArticles();
                this.setupEventListeners();
                this.renderArticles();
            }

            loadArticles() {
                const saved = localStorage.getItem('articles');
                if (saved) {
                    try {
                        this.articles = JSON.parse(saved);
                    } catch (error) {
                        console.error('æ•°æ®æ ¼å¼é”™è¯¯');
                        this.articles = [];
                    }
                }
            }

            setupEventListeners() {
                const form = document.getElementById('onlineArticleForm');
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addArticle();
                });

                // å·¥å…·æŒ‰é’®
                document.getElementById('onlineCleanup').addEventListener('click', () => {
                    this.cleanupContent();
                });

                document.getElementById('onlineFixImages').addEventListener('click', () => {
                    this.fixImageLinks();
                });

                document.getElementById('onlineConvert').addEventListener('click', () => {
                    this.convertImageLinks();
                });

                // å¯¼å…¥å¯¼å‡º
                document.getElementById('exportData').addEventListener('click', () => {
                    this.exportData();
                });

                document.getElementById('importData').addEventListener('click', () => {
                    document.getElementById('importFile').click();
                });

                document.getElementById('importFile').addEventListener('change', (e) => {
                    this.importData(e.target.files[0]);
                });

                // å›¾ç‰‡ç²˜è´´å¤„ç†
                this.setupImageHandling();
            }

            setupImageHandling() {
                const contentTextarea = document.getElementById('onlineContent');
                
                contentTextarea.addEventListener('paste', (e) => {
                    console.log('ç²˜è´´äº‹ä»¶è§¦å‘');
                    const items = e.clipboardData.items;
                    let imageFiles = [];
                    let hasText = false;
                    let hasHtml = false;
                    
                    // æ£€æŸ¥å‰ªè´´æ¿å†…å®¹ç±»å‹
                    for (let i = 0; i < items.length; i++) {
                        const item = items[i];
                        console.log('å‰ªè´´æ¿é¡¹ç›®:', item.type, item.kind);
                        
                        if (item.type.indexOf('image') !== -1) {
                            const file = item.getAsFile();
                            if (file) imageFiles.push(file);
                        } else if (item.type === 'text/html') {
                            hasHtml = true;
                        } else if (item.type === 'text/plain') {
                            hasText = true;
                        }
                    }
                    
                    // å¦‚æœæœ‰HTMLæ ¼å¼çš„æ–‡æœ¬ï¼ˆé€šå¸¸åŒ…å«æ ¼å¼ï¼‰ï¼Œä¼˜å…ˆå¤„ç†HTML
                    if (hasHtml && !imageFiles.length) {
                        console.log('æ£€æµ‹åˆ°HTMLæ ¼å¼å†…å®¹ï¼Œä¿æŒæ ¼å¼ç²˜è´´');
                        e.preventDefault();
                        
                        // è·å–HTMLå†…å®¹
                        const htmlItem = Array.from(items).find(item => item.type === 'text/html');
                        if (htmlItem) {
                            htmlItem.getAsString((htmlContent) => {
                                // å°†HTMLè½¬æ¢ä¸ºMarkdown
                                const markdownContent = this.htmlToMarkdown(htmlContent);
                                this.insertAtCursor(contentTextarea, markdownContent);
                                this.showMessage('å·²ä¿æŒæ ¼å¼ç²˜è´´å†…å®¹', 'success');
                            });
                        }
                    }
                    // å¦‚æœåªæœ‰å›¾ç‰‡ï¼Œå¤„ç†å›¾ç‰‡
                    else if (imageFiles.length > 0 && !hasText && !hasHtml) {
                        e.preventDefault();
                        this.handleImageFiles(imageFiles);
                    }
                    // å¦‚æœæœ‰å›¾ç‰‡å’Œæ–‡æœ¬ï¼Œè®©æ–‡æœ¬æ­£å¸¸ç²˜è´´ï¼Œç„¶åå¤„ç†å›¾ç‰‡
                    else if (imageFiles.length > 0 && (hasText || hasHtml)) {
                        // è®©é»˜è®¤ç²˜è´´è¡Œä¸ºå¤„ç†æ–‡æœ¬ï¼Œç„¶åå¤„ç†å›¾ç‰‡
                        setTimeout(() => {
                            this.handleImageFiles(imageFiles);
                        }, 100);
                    }
                    // å…¶ä»–æƒ…å†µè®©é»˜è®¤è¡Œä¸ºå¤„ç†
                });
            }

            // HTMLè½¬Markdownçš„ç®€å•è½¬æ¢å™¨
            htmlToMarkdown(html) {
                console.log('åŸå§‹HTML:', html.substring(0, 500));
                
                // åˆ›å»ºä¸´æ—¶DOMå…ƒç´ æ¥è§£æHTML
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                
                // å¤„ç†å›¾ç‰‡ - æ›´å…¨é¢çš„å›¾ç‰‡æ£€æµ‹
                const images = tempDiv.querySelectorAll('img');
                images.forEach(img => {
                    const src = img.src || img.getAttribute('src');
                    const alt = img.alt || img.getAttribute('alt') || 'å›¾ç‰‡';
                    if (src) {
                        const markdownImg = `![${alt}](${src})`;
                        img.outerHTML = markdownImg;
                    }
                });
                
                // åŸºæœ¬çš„HTMLåˆ°Markdownè½¬æ¢
                let markdown = tempDiv.innerHTML
                    // æ ‡é¢˜è½¬æ¢
                    .replace(/<h([1-6])[^>]*>(.*?)<\/h[1-6]>/gi, (match, level, text) => {
                        return '\n' + '#'.repeat(parseInt(level)) + ' ' + text.trim() + '\n\n';
                    })
                    // ç²—ä½“è½¬æ¢
                    .replace(/<(strong|b)[^>]*>(.*?)<\/(strong|b)>/gi, '**$2**')
                    // æ–œä½“è½¬æ¢
                    .replace(/<(em|i)[^>]*>(.*?)<\/(em|i)>/gi, '*$2*')
                    // é“¾æ¥è½¬æ¢ï¼ˆä½†æ’é™¤å·²ç»æ˜¯å›¾ç‰‡çš„é“¾æ¥ï¼‰
                    .replace(/<a[^>]*href="([^"]*)"[^>]*>((?:(?!<img).)*?)<\/a>/gi, '[$2]($1)')
                    // æ®µè½è½¬æ¢
                    .replace(/<p[^>]*>(.*?)<\/p>/gi, '$1\n\n')
                    // æ¢è¡Œè½¬æ¢
                    .replace(/<br[^>]*\/?>/gi, '\n')
                    // åˆ—è¡¨è½¬æ¢
                    .replace(/<li[^>]*>(.*?)<\/li>/gi, '- $1\n')
                    .replace(/<\/?(ul|ol)[^>]*>/gi, '\n')
                    // ä»£ç è½¬æ¢
                    .replace(/<code[^>]*>(.*?)<\/code>/gi, '`$1`')
                    .replace(/<pre[^>]*><code[^>]*>(.*?)<\/code><\/pre>/gi, '\n```\n$1\n```\n')
                    .replace(/<pre[^>]*>(.*?)<\/pre>/gi, '\n```\n$1\n```\n')
                    // å¼•ç”¨è½¬æ¢
                    .replace(/<blockquote[^>]*>(.*?)<\/blockquote>/gi, '\n> $1\n')
                    // è¡¨æ ¼è½¬æ¢ï¼ˆåŸºç¡€æ”¯æŒï¼‰
                    .replace(/<table[^>]*>(.*?)<\/table>/gi, '\n$1\n')
                    .replace(/<tr[^>]*>(.*?)<\/tr>/gi, '|$1|\n')
                    .replace(/<t[hd][^>]*>(.*?)<\/t[hd]>/gi, ' $1 |')
                    // æ¸…ç†HTMLæ ‡ç­¾
                    .replace(/<[^>]*>/g, '')
                    // HTMLå®ä½“è§£ç 
                    .replace(/&nbsp;/g, ' ')
                    .replace(/&lt;/g, '<')
                    .replace(/&gt;/g, '>')
                    .replace(/&amp;/g, '&')
                    .replace(/&quot;/g, '"')
                    .replace(/&#39;/g, "'")
                    // æ¸…ç†å¤šä½™ç©ºè¡Œ
                    .replace(/\n{3,}/g, '\n\n')
                    // æ¸…ç†è¡Œé¦–è¡Œå°¾ç©ºæ ¼
                    .replace(/^[ \t]+|[ \t]+$/gm, '');
                
                console.log('è½¬æ¢åçš„Markdown:', markdown.substring(0, 500));
                return markdown.trim();
            }

            // åœ¨å…‰æ ‡ä½ç½®æ’å…¥å†…å®¹
            insertAtCursor(textarea, text) {
                const cursorPos = textarea.selectionStart;
                const textBefore = textarea.value.substring(0, cursorPos);
                const textAfter = textarea.value.substring(cursorPos);
                
                textarea.value = textBefore + text + textAfter;
                textarea.focus();
                textarea.setSelectionRange(cursorPos + text.length, cursorPos + text.length);
            }

            handleImageFiles(files) {
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const base64Data = e.target.result;
                        const fileName = file.name.replace(/\s+/g, '_');
                        const altText = fileName.split('.')[0];
                        
                        // ä¿æŒå®Œæ•´çš„base64æ•°æ®ï¼Œä¸è½¬æ¢ä¸ºå ä½ç¬¦
                        const markdownImage = `![${altText}](${base64Data})\n\n`;
                        const contentTextarea = document.getElementById('onlineContent');
                        const cursorPos = contentTextarea.selectionStart;
                        const textBefore = contentTextarea.value.substring(0, cursorPos);
                        const textAfter = contentTextarea.value.substring(cursorPos);
                        
                        contentTextarea.value = textBefore + markdownImage + textAfter;
                        contentTextarea.focus();
                        contentTextarea.setSelectionRange(cursorPos + markdownImage.length, cursorPos + markdownImage.length);
                        
                        this.showMessage(`å›¾ç‰‡ "${fileName}" å·²æ’å…¥ï¼ˆä¿æŒåŸå§‹æ ¼å¼ï¼‰`, 'success');
                    };
                    reader.readAsDataURL(file);
                });
            }

            addArticle() {
                const title = document.getElementById('onlineTitle').value.trim();
                const url = document.getElementById('onlineUrl').value.trim();
                const description = document.getElementById('onlineDescription').value.trim();
                const content = document.getElementById('onlineContent').value.trim();
                const tagsInput = document.getElementById('onlineTags').value.trim();
                const rating = parseInt(document.getElementById('onlineRating').value);

                if (!title || !content) {
                    this.showMessage('è¯·å¡«å†™æ–‡ç« æ ‡é¢˜å’Œå†…å®¹', 'error');
                    return;
                }

                const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag) : [];

                const newArticle = {
                    id: Date.now(),
                    title,
                    url: url || '',
                    description: description || 'æš‚æ— æè¿°',
                    content,
                    tags,
                    rating,
                    date: new Date().toISOString()
                };

                this.articles.unshift(newArticle);
                this.saveArticles();
                this.renderArticles();
                this.clearForm();
                
                this.showMessage('æ–‡ç« å‘å¸ƒæˆåŠŸï¼å·²åœ¨ä¸»é¡µé¢ç”Ÿæ•ˆ', 'success');
            }

            saveArticles() {
                localStorage.setItem('articles', JSON.stringify(this.articles));
            }

            renderArticles() {
                const container = document.getElementById('onlineArticlesList');
                
                if (this.articles.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— æ–‡ç« </p>';
                    return;
                }
                
                container.innerHTML = this.articles.map(article => `
                    <div class="admin-article-item">
                        <div class="admin-article-info">
                            <h3>${article.title}</h3>
                            <p><strong>æ‘˜è¦:</strong> ${article.description}</p>
                            <p><strong>æ ‡ç­¾:</strong> ${article.tags.join(', ') || 'æ— '}</p>
                            <p><strong>è¯„åˆ†:</strong> ${'â­'.repeat(article.rating)}</p>
                            <p><strong>å‘å¸ƒæ—¶é—´:</strong> ${new Date(article.date).toLocaleString('zh-CN')}</p>
                        </div>
                        <div class="admin-article-actions">
                            <button class="preview-btn" onclick="onlineAdmin.previewArticle(${article.id})">
                                é¢„è§ˆ
                            </button>
                            <button class="delete-btn" onclick="onlineAdmin.deleteArticle(${article.id})">
                                åˆ é™¤
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            previewArticle(id) {
                const article = this.articles.find(a => a.id === id);
                if (!article) return;

                const previewWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
                const htmlContent = marked.parse(article.content);
                
                previewWindow.document.write(`
                    <!DOCTYPE html>
                    <html lang="zh-CN">
                    <head>
                        <meta charset="UTF-8">
                        <title>é¢„è§ˆ: ${article.title}</title>
                        <link rel="stylesheet" href="css/style.css">
                        <style>
                            body { padding: 2rem; background: #f8f9fa; }
                            .preview-container { 
                                max-width: 800px; margin: 0 auto; background: white; 
                                padding: 2rem; border-radius: 10px; 
                                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                            }
                        </style>
                    </head>
                    <body>
                        <div class="preview-container">
                            <h1>${article.title}</h1>
                            <div class="article-content">${htmlContent}</div>
                        </div>
                    </body>
                    </html>
                `);
                previewWindow.document.close();
            }

            deleteArticle(id) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ–‡ç« å—ï¼Ÿ')) {
                    this.articles = this.articles.filter(article => article.id !== id);
                    this.saveArticles();
                    this.renderArticles();
                    this.showMessage('æ–‡ç« å·²åˆ é™¤', 'success');
                }
            }

            cleanupContent() {
                const contentTextarea = document.getElementById('onlineContent');
                let content = contentTextarea.value;
                
                if (!content.trim()) {
                    this.showMessage('è¯·å…ˆè¾“å…¥å†…å®¹', 'error');
                    return;
                }
                
                let cleaned = content
                    .replace(/\n{3,}/g, '\n\n')
                    .replace(/^[ \t]+|[ \t]+$/gm, '')
                    .replace(/\r\n/g, '\n');
                
                contentTextarea.value = cleaned;
                this.showMessage('å†…å®¹å·²æ¸…ç†å®Œæˆï¼', 'success');
            }

            fixImageLinks() {
                const contentTextarea = document.getElementById('onlineContent');
                let content = contentTextarea.value;
                
                if (!content.trim()) {
                    this.showMessage('è¯·å…ˆè¾“å…¥å†…å®¹', 'error');
                    return;
                }
                
                let fixCount = 0;
                
                // ä¿®å¤å„ç§å¯èƒ½çš„å›¾ç‰‡é“¾æ¥æ ¼å¼
                let fixed = content
                    // ä¿®å¤ [å›¾ç‰‡](é“¾æ¥) æ ¼å¼
                    .replace(/\[å›¾ç‰‡\]\(([^)]+)\)/g, (match, url) => {
                        fixCount++;
                        return `![å›¾ç‰‡](${url})`;
                    })
                    // ä¿®å¤ ã€å›¾ç‰‡ã€‘(é“¾æ¥) æ ¼å¼
                    .replace(/ã€å›¾ç‰‡ã€‘\(([^)]+)\)/g, (match, url) => {
                        fixCount++;
                        return `![å›¾ç‰‡](${url})`;
                    })
                    // ä¿®å¤ [image](é“¾æ¥) æ ¼å¼
                    .replace(/\[image\]\(([^)]+)\)/gi, (match, url) => {
                        fixCount++;
                        return `![å›¾ç‰‡](${url})`;
                    })
                    // ä¿®å¤å¯èƒ½çš„é“¾æ¥æ ¼å¼ï¼Œå¦‚æœURLæŒ‡å‘å›¾ç‰‡
                    .replace(/\[([^\]]*)\]\((https?:\/\/[^\s)]+\.(jpg|jpeg|png|gif|webp|svg|bmp)[^\s)]*)\)/gi, (match, text, url) => {
                        fixCount++;
                        return `![${text || 'å›¾ç‰‡'}](${url})`;
                    })
                    // ä¿®å¤ç›´æ¥çš„å›¾ç‰‡URLï¼ˆå•ç‹¬ä¸€è¡Œï¼‰
                    .replace(/^(https?:\/\/[^\s]+\.(jpg|jpeg|png|gif|webp|svg|bmp)[^\s]*)$/gim, (match, url) => {
                        fixCount++;
                        return `![å›¾ç‰‡](${url})`;
                    })
                    // ä¿®å¤å¯èƒ½è¢«è¯†åˆ«ä¸ºæ™®é€šé“¾æ¥çš„å›¾ç‰‡
                    .replace(/\[([^\]]*)\]\(([^)]*(?:jpg|jpeg|png|gif|webp|svg|bmp)[^)]*)\)/gi, (match, text, url) => {
                        if (!match.startsWith('![')) {
                            fixCount++;
                            return `![${text || 'å›¾ç‰‡'}](${url})`;
                        }
                        return match;
                    });
                
                if (fixCount > 0) {
                    contentTextarea.value = fixed;
                    this.showMessage(`å·²ä¿®å¤ ${fixCount} ä¸ªå›¾ç‰‡é“¾æ¥æ ¼å¼`, 'success');
                } else {
                    this.showMessage('æœªæ‰¾åˆ°éœ€è¦ä¿®å¤çš„å›¾ç‰‡é“¾æ¥', 'info');
                }
            }

            convertImageLinks() {
                const contentTextarea = document.getElementById('onlineContent');
                let content = contentTextarea.value;
                
                if (!content.trim()) {
                    this.showMessage('è¯·å…ˆè¾“å…¥å†…å®¹', 'error');
                    return;
                }
                
                let imageCount = 0;
                const converted = content.replace(/!\[([^\]]*)\]\(data:image\/[^;]+;base64,[^)]+\)/g, (match, alt) => {
                    imageCount++;
                    return `![${alt || `å›¾ç‰‡_${imageCount}`}](æœ¬åœ°å›¾ç‰‡_${imageCount})`;
                });
                
                if (imageCount > 0) {
                    contentTextarea.value = converted;
                    this.showMessage(`å·²è½¬æ¢ ${imageCount} ä¸ªå›¾ç‰‡é“¾æ¥ä¸ºå ä½ç¬¦`, 'success');
                } else {
                    this.showMessage('æœªæ‰¾åˆ°éœ€è¦è½¬æ¢çš„å›¾ç‰‡é“¾æ¥', 'info');
                }
            }

            exportData() {
                const dataStr = JSON.stringify(this.articles, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `articles-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                this.showMessage('æ•°æ®å¯¼å‡ºæˆåŠŸï¼', 'success');
            }

            importData(file) {
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (Array.isArray(data)) {
                            this.articles = data;
                            this.saveArticles();
                            this.renderArticles();
                            this.showMessage('æ•°æ®å¯¼å…¥æˆåŠŸï¼', 'success');
                        } else {
                            this.showMessage('æ•°æ®æ ¼å¼é”™è¯¯', 'error');
                        }
                    } catch (error) {
                        this.showMessage('æ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
                    }
                };
                reader.readAsText(file);
            }

            clearForm() {
                document.getElementById('onlineArticleForm').reset();
            }

            showMessage(text, type = 'info') {
                const message = document.createElement('div');
                message.className = `message message-${type}`;
                message.textContent = text;
                document.body.appendChild(message);
                setTimeout(() => {
                    if (message.parentNode) {
                        message.parentNode.removeChild(message);
                    }
                }, 3000);
            }
        }

        // å…¨å±€å˜é‡
        let onlineAdmin;

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            onlineAdmin = new OnlineAdminManager();
        });
    </script>
</body>
</html>